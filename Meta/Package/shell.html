<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Emscripten-Generated Code</title>
    <style>
        html, body, #canvas {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            border: 0;
            overflow: hidden;
        }
        body { background: #111; }
    </style>
</head>
<body>

<div class="spinner" id='spinner'></div>
<div class="emscripten" id="status">Downloading...</div>

<div class="emscripten">
    <progress value="0" max="100" id="progress" hidden=1></progress>
</div>

    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex=-1></canvas>

<script type='text/javascript'>
    var statusElement = document.getElementById('status');
    var progressElement = document.getElementById('progress');
    var spinnerElement = document.getElementById('spinner');
    var canvasElement = document.getElementById('canvas');

    // As a default initial behavior, pop up an alert when webgl context is lost. To make your
    // application robust, you may want to override this behavior before shipping!
    // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
    canvasElement.addEventListener('webglcontextlost', (e) => {
        alert('WebGL context lost. You will need to reload the page.');
        e.preventDefault();
    }, false);

    function resizeCanvas() {
        canvasElement.width = window.innerWidth;
        canvasElement.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas(); // Set initial size

    var setStatus = (text) => {
        if (!setStatus.last) setStatus.last = { time: Date.now(), text: '' };
        if (text === setStatus.last.text) return;
        var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
        var now = Date.now();
        // if this is a progress update, skip it if too soon
        if (m && now - setStatus.last.time < 30) return;
        setStatus.last.time = now;
        setStatus.last.text = text;
        if (m) {
            text = m[1];
            progressElement.value = parseInt(m[2])*100;
            progressElement.max = parseInt(m[4])*100;
            progressElement.hidden = false;
            spinnerElement.hidden = false;
        } else {
            progressElement.value = null;
            progressElement.max = null;
            progressElement.hidden = true;
            if (!text) spinnerElement.style.display = 'none';
        }
        statusElement.innerHTML = text;
    };

    #if MODULARIZE && !EXPORT_ES6
    var moduleArgs = {
        #else
        var Module = {
            #endif
            print(...args) {
                console.log(...args);
            },
            canvas: canvasElement,
            setStatus: setStatus,
            totalDependencies: 0,
            monitorRunDependencies(left) {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
            }
        };
        setStatus('Downloading...');
    window.onerror = (event) => {
        // TODO: do not warn on ok events like simulating an infinite loop or exitStatus
        setStatus('Exception thrown, see JavaScript console');
        spinnerElement.style.display = 'none';
        setStatus = (text) => {
            if (text) console.error('[post-exception status] ' + text);
        };
    };
</script>
{{{ SCRIPT }}}
#if MODULARIZE && !EXPORT_ES6
<script type='text/javascript'>
    {{{ EXPORT_NAME }}}(moduleArgs);
</script>
#endif
</body>
</html>